class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.all_tiles = []
        self.username = getpass.getuser()
        self.db = Database("launcher.db")
        self.setWindowTitle("Application Launcher")
        self.setMinimumSize(1200, 720)
        
        # Initialize the rotation angle for the cursor
        self.cursor_rotation = 0
        self.cursor_timer = QTimer()
        self.cursor_timer.timeout.connect(self.update_cursor)
        self.cursor_timer.setInterval(30)  # Faster updates for smoother animation
        
        # Store the base pixmap
        self.create_cursor_pixmap()
        
        # Rest of your initialization code...
        
        refresh_button = QPushButton("‚ü≥")
        refresh_button.setCursor(Qt.CursorShape.PointingHandCursor)
        refresh_button.clicked.connect(self.start_refresh)
        refresh_button.setStyleSheet("""
            QPushButton {
                background-color: transparent;
                border: none;
                color: #6c757d;
                font-size: 18px;
                padding: 5px;
                min-width: 30px;
            }
            QPushButton:hover {
                color: #4a90e2;
            }
        """)

    def create_cursor_pixmap(self):
        """Create the base cursor pixmap"""
        size = 32
        self.cursor_pixmap = QPixmap(size, size)
        self.cursor_pixmap.fill(Qt.GlobalColor.transparent)
        
        painter = QPainter(self.cursor_pixmap)
        painter.setRenderHint(QPainter.RenderHint.Antialiasing)
        
        # Define pen for the arc
        pen = QPen()
        pen.setColor(QColor("#4a90e2"))
        pen.setWidth(3)
        pen.setCapStyle(Qt.PenCapStyle.RoundCap)
        painter.setPen(pen)
        
        # Draw the circular path
        rect = QRectF(4, 4, size-8, size-8)
        # Draw a larger arc (300 degrees) to make the rotation more visible
        painter.drawArc(rect, 0, 300 * 16)  # Qt uses 16th of a degree
        painter.end()

    def update_cursor(self):
        """Update the rotating cursor"""
        size = 32
        rotated_pixmap = QPixmap(size, size)
        rotated_pixmap.fill(Qt.GlobalColor.transparent)
        
        painter = QPainter(rotated_pixmap)
        painter.setRenderHint(QPainter.RenderHint.Antialiasing)
        
        # Calculate center point
        center = size / 2
        
        # Set up the transformation for rotation
        painter.translate(center, center)
        painter.rotate(self.cursor_rotation)
        painter.translate(-center, -center)
        
        # Draw the original cursor pixmap
        painter.drawPixmap(0, 0, self.cursor_pixmap)
        painter.end()
        
        # Update cursor
        while QApplication.overrideCursor():
            QApplication.restoreOverrideCursor()
        QApplication.setOverrideCursor(QCursor(rotated_pixmap))
        
        # Update rotation angle
        self.cursor_rotation = (self.cursor_rotation + 10) % 360
        
        # Process events to ensure smooth animation
        QApplication.processEvents()

    def start_refresh(self):
        """Start the refresh process with animated cursor"""
        # Clear any existing override cursors
        while QApplication.overrideCursor():
            QApplication.restoreOverrideCursor()
            
        self.cursor_rotation = 0  # Reset rotation
        self.cursor_timer.start()
        
        # Use a QThread for the refresh operation
        self.refresh_thread = QThread()
        self.refresh_thread.run = self.perform_refresh
        self.refresh_thread.finished.connect(self.on_refresh_complete)
        self.refresh_thread.start()

    def perform_refresh(self):
        """Perform the actual refresh operation"""
        self.search_bar.clear()
        self.db = Database("launcher.db")
        self.load_applications()

    def on_refresh_complete(self):
        """Clean up after refresh is complete"""
        self.cursor_timer.stop()
        while QApplication.overrideCursor():
            QApplication.restoreOverrideCursor()
        self.refresh_thread.deleteLater()
